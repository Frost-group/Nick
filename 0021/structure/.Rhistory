X3 = col_double(),
X4 = col_double(),
X5 = col_double(),
X6 = col_double(),
X7 = col_double(),
X8 = col_double(),
X9 = col_double()
)
library("tidyverse")
atom_number <- 19584
########################################################################################
########################################################################################
read_gro <- function(file, time=NULL){
col_types_1 <- cols(
X1 = col_double(),
X2 = col_double(),
X3 = col_double(),
X4 = col_double(),
X5 = col_double(),
X6 = col_double(),
X7 = col_double(),
X8 = col_double(),
X9 = col_double()
)
col_types_3 <- cols(
X1 = col_character(),
X2 = col_character(),
X3 = col_character(),
X4 = col_character(),
X5 = col_character(),
X6 = col_character(),
X7 = col_double()
)
col_types_2 <- cols(
X1 = col_character(),
X2 = col_character(),
X3 = col_integer(),
X4 = col_double(),
X5 = col_double(),
X6 = col_double()
)
par <- read_table(file,skip=(atom_number+2),n_max=1, col_names=FALSE, col_types=col_types_1) %>%
rename(v1x="X1",v2y="X2",v3z="X3",v1y="X4",v1z="X5",v2x="X6",v2z="X7",v3x="X8", v3y="X9")
if (is.null(time)) { time <- read_table(file,n_max=1, col_names=FALSE, col_types=col_types_3) %>%
as_tibble() %>%
select(X7) %>%
as.integer() }
data <- read_table(file,skip=2,n_max=atom_number, col_names=FALSE, col_types=col_types_2) %>%
rename(ResName="X1", AtomName="X2", AtomNumber="X3", x="X4", y="X5", z="X6") %>%
mutate(Time=time) %>%
mutate(v1x=par$v1x,v2y=par$v2y,v3z=par$v3z,v1y=par$v1y,v1z=par$v1z,v2x=par$v2x,v2z=par$v2z,v3x=par$v3x, v3y=par$v3y) %>%
mutate(Part = "Sidechain") %>%
mutate(Part = if_else( (AtomName=="CS1"|
AtomName=="CS2"|
AtomName=="CS3"|
AtomName=="CS4"|
AtomName=="CD1"|
AtomName=="CD2"|
AtomName=="CD3"|
AtomName=="CD4"|
AtomName=="SD"|
AtomName=="SS"|
AtomName=="OS"|
AtomName=="OD"|
AtomName=="HS"|
AtomName=="HD"), "Backbone", Part )) %>%
mutate(Part = if_else( (AtomName=="BrS"|
AtomName=="BrD"|
AtomName=="HS2"|
AtomName=="HD2"), "Terminal", Part )) %>%
select(Time,ResName, AtomName, AtomNumber, Part, x, y, z, v1x, v2y, v3z, v1z, v2x, v2z, v3x, v3y)
return(data)
}
########################################################################################
########################################################################################
files <- dir(pattern="*.gro")
supercell <- read_gro("../super_cell.gro", time=-1) %>%
select(Time, ResName, AtomName, AtomNumber, Part, x, y, z) %>%
rename(ResName0=ResName, AtomName0=AtomName, AtomNumber0=AtomNumber, Part0=Part, x0=x, y0=y, z0=z) %>%
nest(super_cell_data=c(ResName0, AtomName0, AtomNumber0, Part0, x0, y0, z0))
Data <- as_tibble(files) %>%
rename(FileName=value) %>%
mutate(gro = map(FileName, read_gro)) %>%
unnest(c(gro)) %>%
select(Time, ResName, AtomName, AtomNumber, Part, x, y, z) %>%
nest(data=c(ResName, AtomName, AtomNumber, Part, x, y, z)) %>%
mutate(super_cell = supercell$super_cell_data) %>%
unnest(c(data, super_cell)) %>%
filter(Part=="Backbone") %>%
select(AtomName, x,y,z,x0,y0,z0) %>%
mutate(dx2=(x-x0)**2, dy2=(y-y0)**2, dz2=(z-z0)**2) %>%
mutate(dr = sqrt(dx2 + dy2 + dz2)) %>%
select(AtomName, dr) %>%
nest(radii=c(dr)) %>%
mutate(mean = map(radii, mean)) %>%
unnest(mean) %>% print()
View(Data)
View(Data[[2]][[1]])
Data <- as_tibble(files) %>%
rename(FileName=value) %>%
mutate(gro = map(FileName, read_gro)) %>%
unnest(c(gro)) %>%
select(Time, ResName, AtomName, AtomNumber, Part, x, y, z) %>%
nest(data=c(ResName, AtomName, AtomNumber, Part, x, y, z)) %>%
mutate(super_cell = supercell$super_cell_data) %>%
unnest(c(data, super_cell)) %>%
filter(Part=="Backbone") %>%
select(AtomName, x,y,z,x0,y0,z0) %>%
mutate(dx2=(x-x0)**2, dy2=(y-y0)**2, dz2=(z-z0)**2) %>%
mutate(dr = sqrt(dx2 + dy2 + dz2)) %>%
select(AtomName, dr) %>%
nest(radii=c(dr)) %>%
mutate(mean = map(radii$dr, mean)) %>%
unnest(mean) %>% print()
Data <- as_tibble(files) %>%
rename(FileName=value) %>%
mutate(gro = map(FileName, read_gro)) %>%
unnest(c(gro)) %>%
select(Time, ResName, AtomName, AtomNumber, Part, x, y, z) %>%
nest(data=c(ResName, AtomName, AtomNumber, Part, x, y, z)) %>%
mutate(super_cell = supercell$super_cell_data) %>%
unnest(c(data, super_cell)) %>%
filter(Part=="Backbone") %>%
select(AtomName, x,y,z,x0,y0,z0) %>%
mutate(dx2=(x-x0)**2, dy2=(y-y0)**2, dz2=(z-z0)**2) %>%
mutate(dr = sqrt(dx2 + dy2 + dz2)) %>%
select(AtomName, dr) %>%
nest(radii=c(dr)) %>%
mutate(mean = map(radii, mean)) %>%
unnest(mean)
warnings()
Data <- as_tibble(files) %>%
rename(FileName=value) %>%
mutate(gro = map(FileName, read_gro)) %>%
unnest(c(gro)) %>%
select(Time, ResName, AtomName, AtomNumber, Part, x, y, z) %>%
nest(data=c(ResName, AtomName, AtomNumber, Part, x, y, z)) %>%
mutate(super_cell = supercell$super_cell_data) %>%
unnest(c(data, super_cell)) %>%
filter(Part=="Backbone") %>%
select(AtomName, x,y,z,x0,y0,z0) %>%
mutate(dx2=(x-x0)**2, dy2=(y-y0)**2, dz2=(z-z0)**2) %>%
mutate(dr = sqrt(dx2 + dy2 + dz2)) %>%
select(AtomName, dr) %>%
nest(radii=c(dr)) %>%
mutate(mean = map(radii, summarise)) %>%
unnest(mean)
View(Data[[2]][[1]])
Data <- as_tibble(files) %>%
rename(FileName=value) %>%
mutate(gro = map(FileName, read_gro)) %>%
unnest(c(gro)) %>%
select(Time, ResName, AtomName, AtomNumber, Part, x, y, z) %>%
nest(data=c(ResName, AtomName, AtomNumber, Part, x, y, z)) %>%
mutate(super_cell = supercell$super_cell_data) %>%
unnest(c(data, super_cell)) %>%
filter(Part=="Backbone") %>%
select(AtomName, x,y,z,x0,y0,z0) %>%
mutate(dx2=(x-x0)**2, dy2=(y-y0)**2, dz2=(z-z0)**2) %>%
mutate(dr = sqrt(dx2 + dy2 + dz2)) %>%
select(AtomName, dr) %>%
nest(radii=c(dr)) %>%
mutate(mean = map(radii, summarise))
View(Data[[3]][[1]])
Data <- as_tibble(files) %>%
rename(FileName=value) %>%
mutate(gro = map(FileName, read_gro)) %>%
unnest(c(gro)) %>%
select(Time, ResName, AtomName, AtomNumber, Part, x, y, z) %>%
nest(data=c(ResName, AtomName, AtomNumber, Part, x, y, z)) %>%
mutate(super_cell = supercell$super_cell_data) %>%
unnest(c(data, super_cell)) %>%
filter(Part=="Backbone") %>%
select(AtomName, x,y,z,x0,y0,z0) %>%
mutate(dx2=(x-x0)**2, dy2=(y-y0)**2, dz2=(z-z0)**2) %>%
mutate(dr = sqrt(dx2 + dy2 + dz2)) %>%
select(AtomName, dr) %>%
nest(radii=c(dr)) %>%
mutate(mean = map(radii, tidy))
Data <- as_tibble(files) %>%
rename(FileName=value) %>%
mutate(gro = map(FileName, read_gro)) %>%
unnest(c(gro)) %>%
select(Time, ResName, AtomName, AtomNumber, Part, x, y, z) %>%
nest(data=c(ResName, AtomName, AtomNumber, Part, x, y, z)) %>%
mutate(super_cell = supercell$super_cell_data) %>%
unnest(c(data, super_cell)) %>%
filter(Part=="Backbone") %>%
select(AtomName, x,y,z,x0,y0,z0) %>%
mutate(dx2=(x-x0)**2, dy2=(y-y0)**2, dz2=(z-z0)**2) %>%
mutate(dr = sqrt(dx2 + dy2 + dz2)) %>%
select(AtomName, dr) %>%
nest(radii=c(dr)) %>%
mutate(mean = map(radii, broom::tidy))
View(Data[[3]][[1]])
Data <- as_tibble(files) %>%
rename(FileName=value) %>%
mutate(gro = map(FileName, read_gro)) %>%
unnest(c(gro)) %>%
select(Time, ResName, AtomName, AtomNumber, Part, x, y, z) %>%
nest(data=c(ResName, AtomName, AtomNumber, Part, x, y, z)) %>%
mutate(super_cell = supercell$super_cell_data) %>%
unnest(c(data, super_cell)) %>%
filter(Part=="Backbone") %>%
select(AtomName, x,y,z,x0,y0,z0) %>%
mutate(dx2=(x-x0)**2, dy2=(y-y0)**2, dz2=(z-z0)**2) %>%
mutate(dr = sqrt(dx2 + dy2 + dz2)) %>%
select(AtomName, dr) %>%
nest(radii=c(dr)) %>%
mutate(mean = map(radii, average))
Data <- as_tibble(files) %>%
rename(FileName=value) %>%
mutate(gro = map(FileName, read_gro)) %>%
unnest(c(gro)) %>%
select(Time, ResName, AtomName, AtomNumber, Part, x, y, z) %>%
nest(data=c(ResName, AtomName, AtomNumber, Part, x, y, z)) %>%
mutate(super_cell = supercell$super_cell_data) %>%
unnest(c(data, super_cell)) %>%
filter(Part=="Backbone") %>%
select(AtomName, x,y,z,x0,y0,z0) %>%
mutate(dx2=(x-x0)**2, dy2=(y-y0)**2, dz2=(z-z0)**2) %>%
mutate(dr = sqrt(dx2 + dy2 + dz2)) %>%
select(AtomName, dr) %>%
nest(radii=c(dr)) %>%
mutate(mean = map(radii, mean()))
Data <- as_tibble(files) %>%
rename(FileName=value) %>%
mutate(gro = map(FileName, read_gro)) %>%
unnest(c(gro)) %>%
select(Time, ResName, AtomName, AtomNumber, Part, x, y, z) %>%
nest(data=c(ResName, AtomName, AtomNumber, Part, x, y, z)) %>%
mutate(super_cell = supercell$super_cell_data) %>%
unnest(c(data, super_cell)) %>%
filter(Part=="Backbone") %>%
select(AtomName, x,y,z,x0,y0,z0) %>%
mutate(dx2=(x-x0)**2, dy2=(y-y0)**2, dz2=(z-z0)**2) %>%
mutate(dr = sqrt(dx2 + dy2 + dz2)) %>%
select(AtomName, dr) %>%
nest(radii=c(dr)) %>%
mutate(mean = map(radii, median))
library("tidyverse")
atom_number <- 19584
########################################################################################
########################################################################################
read_gro <- function(file, time=NULL){
col_types_1 <- cols(
X1 = col_double(),
X2 = col_double(),
X3 = col_double(),
X4 = col_double(),
X5 = col_double(),
X6 = col_double(),
X7 = col_double(),
X8 = col_double(),
X9 = col_double()
)
col_types_3 <- cols(
X1 = col_character(),
X2 = col_character(),
X3 = col_character(),
X4 = col_character(),
X5 = col_character(),
X6 = col_character(),
X7 = col_double()
)
col_types_2 <- cols(
X1 = col_character(),
X2 = col_character(),
X3 = col_integer(),
X4 = col_double(),
X5 = col_double(),
X6 = col_double()
)
par <- read_table(file,skip=(atom_number+2),n_max=1, col_names=FALSE, col_types=col_types_1) %>%
rename(v1x="X1",v2y="X2",v3z="X3",v1y="X4",v1z="X5",v2x="X6",v2z="X7",v3x="X8", v3y="X9")
if (is.null(time)) { time <- read_table(file,n_max=1, col_names=FALSE, col_types=col_types_3) %>%
as_tibble() %>%
select(X7) %>%
as.integer() }
data <- read_table(file,skip=2,n_max=atom_number, col_names=FALSE, col_types=col_types_2) %>%
rename(ResName="X1", AtomName="X2", AtomNumber="X3", x="X4", y="X5", z="X6") %>%
mutate(Time=time) %>%
mutate(v1x=par$v1x,v2y=par$v2y,v3z=par$v3z,v1y=par$v1y,v1z=par$v1z,v2x=par$v2x,v2z=par$v2z,v3x=par$v3x, v3y=par$v3y) %>%
mutate(Part = "Sidechain") %>%
mutate(Part = if_else( (AtomName=="CS1"|
AtomName=="CS2"|
AtomName=="CS3"|
AtomName=="CS4"|
AtomName=="CD1"|
AtomName=="CD2"|
AtomName=="CD3"|
AtomName=="CD4"|
AtomName=="SD"|
AtomName=="SS"|
AtomName=="OS"|
AtomName=="OD"|
AtomName=="HS"|
AtomName=="HD"), "Backbone", Part )) %>%
mutate(Part = if_else( (AtomName=="BrS"|
AtomName=="BrD"|
AtomName=="HS2"|
AtomName=="HD2"), "Terminal", Part )) %>%
select(Time,ResName, AtomName, AtomNumber, Part, x, y, z, v1x, v2y, v3z, v1z, v2x, v2z, v3x, v3y)
return(data)
}
########################################################################################
########################################################################################
files <- dir(pattern="*.gro")
supercell <- read_gro("../super_cell.gro", time=-1) %>%
select(Time, ResName, AtomName, AtomNumber, Part, x, y, z) %>%
rename(ResName0=ResName, AtomName0=AtomName, AtomNumber0=AtomNumber, Part0=Part, x0=x, y0=y, z0=z) %>%
nest(super_cell_data=c(ResName0, AtomName0, AtomNumber0, Part0, x0, y0, z0))
Data <- as_tibble(files) %>%
rename(FileName=value) %>%
mutate(gro = map(FileName, read_gro)) %>%
unnest(c(gro)) %>%
select(Time, ResName, AtomName, AtomNumber, Part, x, y, z) %>%
nest(data=c(ResName, AtomName, AtomNumber, Part, x, y, z)) %>%
mutate(super_cell = supercell$super_cell_data) %>%
unnest(c(data, super_cell)) %>%
filter(Part=="Backbone") %>%
select(AtomName, x,y,z,x0,y0,z0) %>%
mutate(dx2=(x-x0)**2, dy2=(y-y0)**2, dz2=(z-z0)**2) %>%
mutate(dr = sqrt(dx2 + dy2 + dz2)) %>%
select(AtomName, dr) %>%
group_by(AtomName) %>%
nest() %>%
mutate(mean = map(data, summary)) %>%
print()
Data <- as_tibble(files) %>%
rename(FileName=value) %>%
mutate(gro = map(FileName, read_gro)) %>%
unnest(c(gro)) %>%
select(Time, ResName, AtomName, AtomNumber, Part, x, y, z) %>%
nest(data=c(ResName, AtomName, AtomNumber, Part, x, y, z)) %>%
mutate(super_cell = supercell$super_cell_data) %>%
unnest(c(data, super_cell)) %>%
filter(Part=="Backbone") %>%
select(AtomName, x,y,z,x0,y0,z0) %>%
mutate(dx2=(x-x0)**2, dy2=(y-y0)**2, dz2=(z-z0)**2) %>%
mutate(dr = sqrt(dx2 + dy2 + dz2)) %>%
select(AtomName, dr) %>%
group_by(AtomName) %>%
nest() %>%
mutate(summary = map(data, summary)) %>%
mutate(mean = summary$mean)
Data <- as_tibble(files) %>%
rename(FileName=value) %>%
mutate(gro = map(FileName, read_gro)) %>%
unnest(c(gro)) %>%
select(Time, ResName, AtomName, AtomNumber, Part, x, y, z) %>%
nest(data=c(ResName, AtomName, AtomNumber, Part, x, y, z)) %>%
mutate(super_cell = supercell$super_cell_data) %>%
unnest(c(data, super_cell)) %>%
filter(Part=="Backbone") %>%
select(AtomName, x,y,z,x0,y0,z0) %>%
mutate(dx2=(x-x0)**2, dy2=(y-y0)**2, dz2=(z-z0)**2) %>%
mutate(dr = sqrt(dx2 + dy2 + dz2)) %>%
select(AtomName, dr) %>%
group_by(AtomName) %>%
nest() %>%
mutate(summary = map(data, summary)) %>%
mutate(mean = summary$mean)
Data <- as_tibble(files) %>%
rename(FileName=value) %>%
mutate(gro = map(FileName, read_gro)) %>%
unnest(c(gro)) %>%
select(Time, ResName, AtomName, AtomNumber, Part, x, y, z) %>%
nest(data=c(ResName, AtomName, AtomNumber, Part, x, y, z)) %>%
mutate(super_cell = supercell$super_cell_data) %>%
unnest(c(data, super_cell)) %>%
filter(Part=="Backbone") %>%
select(AtomName, x,y,z,x0,y0,z0) %>%
mutate(dx2=(x-x0)**2, dy2=(y-y0)**2, dz2=(z-z0)**2) %>%
mutate(dr = sqrt(dx2 + dy2 + dz2)) %>%
select(AtomName, dr) %>%
group_by(AtomName) %>%
nest() %>%
mutate(summary = map(data, summary)) %>%
mutate(mean = summary[1])
Data <- as_tibble(files) %>%
rename(FileName=value) %>%
mutate(gro = map(FileName, read_gro)) %>%
unnest(c(gro)) %>%
select(Time, ResName, AtomName, AtomNumber, Part, x, y, z) %>%
nest(data=c(ResName, AtomName, AtomNumber, Part, x, y, z)) %>%
mutate(super_cell = supercell$super_cell_data) %>%
unnest(c(data, super_cell)) %>%
filter(Part=="Backbone") %>%
select(AtomName, x,y,z,x0,y0,z0) %>%
mutate(dx2=(x-x0)**2, dy2=(y-y0)**2, dz2=(z-z0)**2) %>%
mutate(dr = sqrt(dx2 + dy2 + dz2)) %>%
select(AtomName, dr) %>%
group_by(AtomName) %>%
nest() %>%
mutate(summary = map(data, summary)) %>%
mutate(mean = summary[1])
Data <- as_tibble(files) %>%
rename(FileName=value) %>%
mutate(gro = map(FileName, read_gro)) %>%
unnest(c(gro)) %>%
select(Time, ResName, AtomName, AtomNumber, Part, x, y, z) %>%
nest(data=c(ResName, AtomName, AtomNumber, Part, x, y, z)) %>%
mutate(super_cell = supercell$super_cell_data) %>%
unnest(c(data, super_cell)) %>%
filter(Part=="Backbone") %>%
select(AtomName, x,y,z,x0,y0,z0) %>%
mutate(dx2=(x-x0)**2, dy2=(y-y0)**2, dz2=(z-z0)**2) %>%
mutate(dr = sqrt(dx2 + dy2 + dz2)) %>%
select(AtomName, dr) %>%
group_by(AtomName) %>%
nest() %>%
mutate(summary = map(data, summary)) %>%
mutate(mean = summary$mean)
Data <- as_tibble(files) %>%
rename(FileName=value) %>%
mutate(gro = map(FileName, read_gro)) %>%
unnest(c(gro)) %>%
select(Time, ResName, AtomName, AtomNumber, Part, x, y, z) %>%
nest(data=c(ResName, AtomName, AtomNumber, Part, x, y, z)) %>%
mutate(super_cell = supercell$super_cell_data) %>%
unnest(c(data, super_cell)) %>%
filter(Part=="Backbone") %>%
select(AtomName, x,y,z,x0,y0,z0) %>%
mutate(dx2=(x-x0)**2, dy2=(y-y0)**2, dz2=(z-z0)**2) %>%
mutate(dr = sqrt(dx2 + dy2 + dz2)) %>%
select(AtomName, dr) %>%
group_by(AtomName) %>%
nest() %>%
mutate(summary = map(data, summary)) %>%
mutate(mean = summary[1][1])
Data <- as_tibble(files) %>%
rename(FileName=value) %>%
mutate(gro = map(FileName, read_gro)) %>%
unnest(c(gro)) %>%
select(Time, ResName, AtomName, AtomNumber, Part, x, y, z) %>%
nest(data=c(ResName, AtomName, AtomNumber, Part, x, y, z)) %>%
mutate(super_cell = supercell$super_cell_data) %>%
unnest(c(data, super_cell)) %>%
filter(Part=="Backbone") %>%
select(AtomName, x,y,z,x0,y0,z0) %>%
mutate(dx2=(x-x0)**2, dy2=(y-y0)**2, dz2=(z-z0)**2) %>%
mutate(dr = sqrt(dx2 + dy2 + dz2)) %>%
select(AtomName, dr) %>%
group_by(AtomName) %>%
nest() %>%
mutate(summary = map(data, summarise))
View(Data[[3]][[1]])
Data <- as_tibble(files) %>%
rename(FileName=value) %>%
mutate(gro = map(FileName, read_gro)) %>%
unnest(c(gro)) %>%
select(Time, ResName, AtomName, AtomNumber, Part, x, y, z) %>%
nest(data=c(ResName, AtomName, AtomNumber, Part, x, y, z)) %>%
mutate(super_cell = supercell$super_cell_data) %>%
unnest(c(data, super_cell)) %>%
filter(Part=="Backbone") %>%
select(AtomName, x,y,z,x0,y0,z0) %>%
mutate(dx2=(x-x0)**2, dy2=(y-y0)**2, dz2=(z-z0)**2) %>%
mutate(dr = sqrt(dx2 + dy2 + dz2)) %>%
select(AtomName, dr) %>%
group_by(AtomName) %>%
nest() %>%
mutate(summary = map(data, mean))
View(Data)
Data <- as_tibble(files) %>%
rename(FileName=value) %>%
mutate(gro = map(FileName, read_gro)) %>%
unnest(c(gro)) %>%
select(Time, ResName, AtomName, AtomNumber, Part, x, y, z) %>%
nest(data=c(ResName, AtomName, AtomNumber, Part, x, y, z)) %>%
mutate(super_cell = supercell$super_cell_data) %>%
unnest(c(data, super_cell)) %>%
filter(Part=="Backbone") %>%
select(AtomName, x,y,z,x0,y0,z0) %>%
mutate(dx2=(x-x0)**2, dy2=(y-y0)**2, dz2=(z-z0)**2) %>%
mutate(dr = sqrt(dx2 + dy2 + dz2)) %>%
select(AtomName, dr) %>%
group_by(AtomName) %>%
nest() %>%
mutate(mean = mean(.$data)))
Data <- as_tibble(files) %>%
rename(FileName=value) %>%
mutate(gro = map(FileName, read_gro)) %>%
unnest(c(gro)) %>%
select(Time, ResName, AtomName, AtomNumber, Part, x, y, z) %>%
nest(data=c(ResName, AtomName, AtomNumber, Part, x, y, z)) %>%
mutate(super_cell = supercell$super_cell_data) %>%
unnest(c(data, super_cell)) %>%
filter(Part=="Backbone") %>%
select(AtomName, x,y,z,x0,y0,z0) %>%
mutate(dx2=(x-x0)**2, dy2=(y-y0)**2, dz2=(z-z0)**2) %>%
mutate(dr = sqrt(dx2 + dy2 + dz2)) %>%
select(AtomName, dr) %>%
group_by(AtomName) %>%
nest() %>%
mutate(mean = mean(.$data))
Data <- as_tibble(files) %>%
rename(FileName=value) %>%
mutate(gro = map(FileName, read_gro)) %>%
unnest(c(gro)) %>%
select(Time, ResName, AtomName, AtomNumber, Part, x, y, z) %>%
nest(data=c(ResName, AtomName, AtomNumber, Part, x, y, z)) %>%
mutate(super_cell = supercell$super_cell_data) %>%
unnest(c(data, super_cell)) %>%
filter(Part=="Backbone") %>%
select(AtomName, x,y,z,x0,y0,z0) %>%
mutate(dx2=(x-x0)**2, dy2=(y-y0)**2, dz2=(z-z0)**2) %>%
mutate(dr = sqrt(dx2 + dy2 + dz2)) %>%
select(AtomName, dr) %>%
group_by(AtomName) %>%
mutate(mean = mean(dr))
